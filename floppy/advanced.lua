local a,b,c,s={},{},component.invoke,nil local function d(d1)local d2={"B","KiB","MiB","GiB"}local d3=1 while d1>1024 and d2[d3]do d3=d3+1 d1=d1/1024 end return d1.." "..d2[d3]end local function e(e1)local e2=c(e1,"readSector",1)for i=1,#e2 do if e2:sub(i,i)=="\0"then e2=e2:sub(1,i-1)break end end return e2 end local f=component.list("eeprom")()computer.getBootAddress=function()return c(f,"getData")end computer.setBootAddress=function(addr)return c(f,"setData",addr)end local function g(g1)if component.type(g1)=="drive"then local f=load(e(g1))if not f then return false end return true elseif component.type(g1)=="filesystem"then return c(g1,"exists","init.lua")and not c(g1,"isDirectory","init.lua")else return false end end for h in pairs(component.list("drive"))do if g(h) then a[#a+1]=h end end for h in pairs(component.list("filesystem"))do if g(h)then b[#b+1]=h end end local i=component.list("screen")()local j=component.list("gpu")()c(j,"bind",i)c(j,"setResolution",c(j,"maxResolution"))local k,l = c(j,"getResolution")local function m()c(j,"setForeground", 0xFFFFFF)c(j,"setBackground",0)c(j,"fill",1,1,k,l," ")end m()local function n(n1, n2)local n3=k/2-#n1/2 c(j,"set",n3,n2,n1)end local o={}for _,v in pairs(a)do o[#o+1]=v end for _,v in pairs(b)do o[#o+1]=v end local p=computer.getBootAddress()for q,r in pairs(o)do if r==p then s=q break end end if s==nil then s=1 end local function t()n("Advanced Bootloader",2)n("Select boot medium",3)n("Computer Memory: "..d(computer.totalMemory()),4)for t1,v in pairs(o)do if t1==s then c(j,"setForeground",0)c(j,"setBackground",0xFFFFFF)end c(j,"fill",1,t1+5,k,1," ")n(v.."("..(c(v,"getLabel")or"No Label")..")",t1+5)if t1==s then c(j,"setForeground",0xFFFFFF)c(j,"setBackground",0)end end end local function u(u1)m()n("Booting "..u1.."("..(c(u1, "getLabel")or"No Label")..")",math.floor(l/2))n("Please wait...",math.floor(l/2)+1)computer.setBootAddress(u1)if component.type(u1)=="filesystem"then local u2,u3=c(u1,"open","/init.lua")if not u2 then error(u3)end local u4=""repeat local u5=c(u1,"read",u2,math.huge)u4=u4..(u5 or"")until not u5 return load(u4, "=init")()elseif component.type(u1)=="drive"then return load(e(u1),"=init")()end m()end if#o==1 then u(o[1])elseif#o==0 then error("No bootable device!")end t()while true do local e,_,_,y=computer.pullSignal()if e=="key_down"then if y==208 then s=s+1 if s>#o then s=1 end elseif y==200 then s=s-1 if s<1 then s=#o end elseif y==28 then return u(o[s])end t()elseif e=="touch"then if o[y-5]then if s==y-5 then u(o[s])else s=y-5 end end t()end end